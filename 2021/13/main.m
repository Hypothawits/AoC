clear;
##fid = fopen ("test.txt");
fid = fopen ("input.txt");
% save full lines into a new file if only chars inside

%dataTest = [724 201 596 511 883 560 637 47 869 537 251 505 851 618 980 544 818 661 1093 390 641 95 1006 621 447 434 820 865 475 847 788 72 1066 829 1303 882 1165 696 164 229 202 333 244 485 261 840 1116 581 976 513 550 635 1151 728 1211 570 228 422 223 539 406 369 306 758 1247 894 760 859 826 737 340 637 1293 47 99 187 264 553 927 523 940 189 586 313 525 67 296 581 353 694 55 264 582 491 264 154 512 394 1101 225 555 187 1021 535 805 772 783 891 403 402 1243 94 495 593 1031 695 13 472 705 637 459 618 939 322 251 82 899 523 301 131 873 891 880 374 894 737 306 593 1257 280 88 885 621 655 38 640 514 539 1222 885 1257 135 1191 303 1034 715 649 738 719 103 1131 367 907 402 169 297 482 408 977 866 1280 432 1087 803 473 810 182 546 785 155 1257 871 1091 483 310 52 758 712 870 715 1211 772 1173 40 73 460 117 312 228 243 918 822 475 50 765 3 1113 410 127 544 880 422 291 675 1088 187 957 506 591 791 566 437 1178 593 159 728 1237 684 490 665 929 311 641 267 966 766 1081 253 735 649 857 750 999 367 989 221 0 185 445 395 108 168 586 761 1203 595 1115 89 838 665 487 301 289 647 903 133 251 53 887 800 1093 443 775 684 1026 481 601 311 661 476 1198 627 0 753 1231 786 410 821 358 742 1179 780 763 435 1077 133 927 182 681 144 497 597 1088 483 649 476 1202 415 440 583 1198 14 104 775 619 443 410 660 1034 656 115 575 601 728 338 222 84 301 1111 891 1211 122 653 614 1290 282 209 582 440 43 929 583 53 166 1004 301 263 572 818 233 1183 319 228 472 1257 166 656 329 53 135 669 267 815 593 1111 767 802 576 1226 660 1215 800 341 218 181 422 1046 565 159 280 119 303 1027 303 147 417 571 859 1173 261 1054 885 239 302 228 131 85 217 1231 226 137 709 21 131 1290 612 718 845 837 782 164 141 632 467 749 313 525 379 858 561 851 786 1228 857 33 239 868 670 1183 3 248 548 328 345 898 436 438 893 823 301 820 589 937 771 875 58 790 617 64 504 95 675 508 576 729 434 186 91 1092 392 403 166 87 514 1261 114 1141 597 217 390 689 151 457 515 585 805 1131 360 1212 472 669 464 318 682 485 73 1154 644 738 37 1297 870 361 207 932 238 880 264 376 738 87 380 174 94 411 819 845 633 1288 721 189 261 1294 374 72 267 649 642 156 644 517 406 705 562 1059 614 813 856 623 702 619 462 403 728 344 52 1178 634 1275 238 656 47 1176 169 244 821 328 121 1092 255 872 1 845 185 251 707 79 674 659 705 1048 520 1121 709 107 768 427 334 1257 311 112 14 997 351 552 429 1064 159 1114 453 398 306 1208 182 187 175 654 719 1225 665 735 245 1078 245 544 598 691 238 1168 164 264 740 855 833 1260 267 661 156 333 194 1212 870 555 803 445 11 1275 443 1067 35 783 787 785 379 162 141 661 866 873 3 321 476 1136 800 673 47 723 800 1129 84 127 891 927 371 781 647 1099 247 1275 3 691 891 218 639 731 626 1093 504 550 735 1019 880 477 142 147 508 392 822 542 432 209 235 410 234 895 113 107 798 7 23 119 591 709 364 1059 340 1198 148 179 360 226 49 43 98 195 640 452 561 49 52 359 761 1307 749 1235 392 556 355 547 58 790 725 8 683 1261 724 301 185 69 89 545 339 957 759 509 84 1235 564 663 12 1017 743 739 332 1213 392 1067 444 291 616 969 851 353 819 669 95 902 436 127 575 887 143 671 79 796 539 865 11 289 247 465 709 605 724 194 581 1223 788 810 771 932 208 333 225 1308 96 1257 23 709 311 87 123 845 807 845 574 552 630 1226 234 16 374 1247 0 381 311 957 11 393 392 545 219 523 332 820 661 472 229 1079 542 99 570 311 847 1130 500 519 135 207 434 435 235 373 499 731 368 800 348 373 771 904 861 687 192 1297 24 681 131 545 555 705 170 1009 200 63 828 1193 582 211 647 982 495 1206 159 1014 581 284 481 1294 394 5 156 641 627 744 885 900 212 557 887 908 289 786 856 785 515 527 61 73 684 698 637 522 294 79 226 843 175 754 315 798 606 25 730 790 169 947 686 509 646 157 38 994 451 31 702 622 453 390 742 256 558 1274 448 950 833 619 238 723 94 67 94 490 383 447 658 654 686 407 313 1054 9 982 175 1215 766 1198 880 1054 306 1305 156 407 245 328 208 273 787 693 807 939 751 232 245 1047 770 1063 133 87 828 1285 409 787 803 1056 715 654 701 1201 56 865 728 1000 318 546 31 671 63 490 29 863 658 234 841 940 481 7 460 1213 495 411 75 1280 856 949 599 743 106 301 435 390 497 416 157 411 523 1057 12 907 492 1138 486 132 301 383 571 833 304 271 323 788 238 726 112 30 432 1288 313 688 441 605 649 982 345 174 652 527 721 284 257 927 571 623 254 1082 243 977 669 472 665 705 724 947 768 559 800 951 133 207 460 279 247 360 833 1223 514 63 0 182 5 522 520 17 495 555 324 390 397 827 882 107 683 430 856 1150 656 579 788 769 170 164 677 1082 651 883 894 982 656 641 198 576 320 863 210 857 144 984 549 672 766 67 800 35 443 412 682 326 529 304 621 556 539 117 669 918 72 654 47 219 388 654 753 1246 56 654 641 1250 848 562 681 72 403 1228 305 641 422 758 856 1082 472 701 256 1077 761 820 511 755 324 658 509 960 733 801 10 769 378 430 38 647 12 129 291 201 750 522 374 837 422 75 564 977 225 609 256 855 350 1128 5 1245 495 1240 530 591 551 555 154 45 275 381 359 922 253 1026 257 251 280 629 798 739 371 492 708 719 551 508 318 678 427 1109 302 754 539 884 472 705 245 654 453 256 530 1184 793 79 201 731 788 1076 53 430 264 999 54 691 432 837 810 669 696 181 810 132 520 885 641 117 480 729 460 437 891 242 212 1263 507 353 75 316 787 179 24 967 815 490 305 214 583 801 646 1278 441 1163 392 485 521 845 709 104 159 276 715 85 229 522 145 214 851 377 257 490 661 1285 485 278 828 492 661 363 686 709 82 970 705 535 882 256 364 131 114 427 635 440 179 890 681 1029 571 360 61 78 413 746 179 1128 889 1288 173 1213 47 321 700 137 40 720 315 1241 89 137 807 99 539 104 287 527 891 415 116 229 253 574 605 276 686 329 838 1309 728 95 667 899 819 561 805 669 430 1206 735 1006 313 231 542 438 669 1211 355 947 880 783 168 93 581 415 302 195 254 231 784 442 670 872 225 800 98 817 58 1079 94 341 340 131 780 426 315 1211 826 1247 707 363 219 406 817 820 383 465 633 547 459 334 605 1115 254 927 164 5 866 239 778 97 847 271 730 75 392 438 225 326 686 570 301 564 179 195 192 1225 217 751 367 477 116 1116 805 801 84 247 674 189 126 1101 499 1161 570 989 418 400 491 810 123 468 397 1235 523 803 607 247 133 0 847 1146 305 884 315 164 569 913 313 412 212 112 627 209 312 711 523 427 894 1235 140 131 803 1232 413 199 891 49 724 947 14 313 351 898 10 1277 655 887 334 982 719 1230 829 316 222 209 728 592 845 1285 803 490 589 903 245 283 591 1197 516 197 827 619 451 509 884 1297 43 1141 73 1131 63 584 530 820 29 107 836 251 841 529 247 400 715 607 387 301 759 1048 374 227 707 281 771 711 607 1049 392 304 313 1235 626 209 883 452 333 30 408 403 492 510 98 933 68 161 58 1242 693 251 389 1191 322 1131 527 1213 439 586 201 904 369 783 319 929 359 838 348 878 411 109 443 1082 131 350 621 1048 889 326 208 763 96 132 593 84 350 1059 82 678 467 1091 836 1235 371 582 715 641 464 55 795 293 687 723 336 341 472 371 322 555 602 840 500 199 833 455 833 169 73 97 392 783 385 623 640 1111 840 765 891 1046 553 383 164 907 812 1131 870 1067 892 1129 472 246 436 644 670 624 38 353 135 666 227 835 399 112 148 247 859 383 99 535 684 338 555 552 805 594 17 880 472 801 436 997 472 559 667 341 676 247 35 1193 225 1 56 545 3 1149 58 455 710 753 887 687 640 1220 379 1115 724 1203 574 465 320 84 772 1273 359 873 339 783 3 199 54 1193 669 264 329 246 513 33 655 1293 495 432 187 601 871 803 47 825 373 259 110 586 245 412 436 927 347 345 775 970 257 870 311];
xData = [724 596 883 637 869 251 851 980 818 1093 641 1006 447 820 475 788 1066 1303 1165 164 202 244 261 1116 976 550 1151 1211 228 223 406 306 1247 760 826 340 1293 99 264 927 940 586 525 296 353 55 582 264 512 1101 555 1021 805 783 403 1243 495 1031 13 705 459 939 251 899 301 873 880 894 306 1257 88 621 38 514 1222 1257 1191 1034 649 719 1131 907 169 482 977 1280 1087 473 182 785 1257 1091 310 758 870 1211 1173 73 117 228 918 475 765 1113 127 880 291 1088 957 591 566 1178 159 1237 490 929 641 966 1081 735 857 999 989 0 445 108 586 1203 1115 838 487 289 903 251 887 1093 775 1026 601 661 1198 0 1231 410 358 1179 763 1077 927 681 497 1088 649 1202 440 1198 104 619 410 1034 115 601 338 84 1111 1211 653 1290 209 440 929 53 1004 263 818 1183 228 1257 656 53 669 815 1111 802 1226 1215 341 181 1046 159 119 1027 147 571 1173 1054 239 228 85 1231 137 21 1290 718 837 164 632 749 525 858 851 1228 33 868 1183 248 328 898 438 823 820 937 875 790 64 95 508 729 186 1092 403 87 1261 1141 217 689 457 585 1131 1212 669 318 485 1154 738 1297 361 932 880 376 87 174 411 845 1288 189 1294 72 649 156 517 705 1059 813 623 619 403 344 1178 1275 656 1176 244 328 1092 872 845 251 79 659 1048 1121 107 427 1257 112 997 552 1064 1114 398 1208 187 654 1225 735 1078 544 691 1168 264 855 1260 661 333 1212 555 445 1275 1067 783 785 162 661 873 321 1136 673 723 1129 127 927 781 1099 1275 691 218 731 1093 550 1019 477 147 392 542 209 410 895 107 7 119 709 1059 1198 179 226 43 195 452 49 359 1307 1235 556 547 790 8 1261 301 69 545 957 509 1235 663 1017 739 1213 1067 291 969 353 669 902 127 887 671 796 865 289 465 605 194 1223 810 932 333 1308 1257 709 87 845 845 552 1226 16 1247 381 957 393 545 523 820 472 1079 99 311 1130 519 207 435 373 731 800 373 904 687 1297 681 545 705 1009 63 1193 211 982 1206 1014 284 1294 5 641 744 900 557 908 786 785 527 73 698 522 79 843 754 798 25 790 947 509 157 994 31 622 390 256 1274 950 619 723 67 490 447 654 407 1054 982 1215 1198 1054 1305 407 328 273 693 939 232 1047 1063 87 1285 787 1056 654 1201 865 1000 546 671 490 863 234 940 7 1213 411 1280 949 743 301 390 416 411 1057 907 1138 132 383 833 271 788 726 30 1288 688 605 982 174 527 284 927 623 1082 977 472 705 947 559 951 207 279 360 1223 63 182 522 17 555 390 827 107 430 1150 579 769 164 1082 883 982 641 576 863 857 984 672 67 35 412 326 304 556 117 918 654 219 654 1246 654 1250 562 72 1228 641 758 1082 701 1077 820 755 658 960 801 769 430 647 129 201 522 837 75 977 609 855 1128 1245 1240 591 555 45 381 922 1026 251 629 739 492 719 508 678 1109 754 884 705 654 256 1184 79 731 1076 430 999 691 837 669 181 132 885 117 729 437 242 1263 353 316 179 967 490 214 801 1278 1163 485 845 104 276 85 522 214 377 490 1285 278 492 363 709 970 535 256 131 427 440 890 1029 360 78 746 1128 1288 1213 321 137 720 1241 137 99 104 527 415 229 574 276 329 1309 95 899 561 669 1206 1006 231 438 1211 947 783 93 415 195 231 442 872 800 817 1079 341 131 426 1211 1247 363 406 820 465 547 334 1115 927 5 239 97 271 75 438 326 570 564 195 1225 751 477 1116 801 247 189 1101 1161 989 400 810 468 1235 803 247 0 1146 884 164 913 412 112 209 711 427 1235 131 1232 199 49 947 313 898 1277 887 982 1230 316 209 592 1285 490 903 283 1197 197 619 509 1297 1141 1131 584 820 107 251 529 400 607 301 1048 227 281 711 1049 304 1235 209 452 30 403 510 933 161 1242 251 1191 1131 1213 586 904 783 929 838 878 109 1082 350 1048 326 763 132 84 1059 678 1091 1235 582 641 55 293 723 341 371 555 840 199 455 169 97 783 623 1111 765 1046 383 907 1131 1067 1129 246 644 624 353 666 835 112 247 383 535 338 552 594 880 801 997 559 341 247 1193 1 545 1149 455 753 687 1220 1115 1203 465 84 1273 873 783 199 1193 264 246 33 1293 432 601 803 825 259 586 412 927 345 970 870];
yData = [201 511 560 47 537 505 618 544 661 390 95 621 434 865 847 72 829 882 696 229 333 485 840 581 513 635 728 570 422 539 369 758 894 859 737 637 47 187 553 523 189 313 67 581 694 264 491 154 394 225 187 535 772 891 402 94 593 695 472 637 618 322 82 523 131 891 374 737 593 280 885 655 640 539 885 135 303 715 738 103 367 402 297 408 866 432 803 810 546 155 871 483 52 712 715 772 40 460 312 243 822 50 3 410 544 422 675 187 506 791 437 593 728 684 665 311 267 766 253 649 750 367 221 185 395 168 761 595 89 665 301 647 133 53 800 443 684 481 311 476 627 753 786 821 742 780 435 133 182 144 597 483 476 415 583 14 775 443 660 656 575 728 222 301 891 122 614 282 582 43 583 166 301 572 233 319 472 166 329 135 267 593 767 576 660 800 218 422 565 280 303 303 417 859 261 885 302 131 217 226 709 131 612 845 782 141 467 313 379 561 786 857 239 670 3 548 345 436 893 301 589 771 58 617 504 675 576 434 91 392 166 514 114 597 390 151 515 805 360 472 464 682 73 644 37 870 207 238 264 738 380 94 819 633 721 261 374 267 642 644 406 562 614 856 702 462 728 52 634 238 47 169 821 121 255 1 185 707 674 705 520 709 768 334 311 14 351 429 159 453 306 182 175 719 665 245 245 598 238 164 740 833 267 156 194 870 803 11 443 35 787 379 141 866 3 476 800 47 800 84 891 371 647 247 3 891 639 626 504 735 880 142 508 822 432 235 234 113 798 23 591 364 340 148 360 49 98 640 561 52 761 749 392 355 58 725 683 724 185 89 339 759 84 564 12 743 332 392 444 616 851 819 95 436 575 143 79 539 11 247 709 724 581 788 771 208 225 96 23 311 123 807 574 630 234 374 0 311 11 392 219 332 661 229 542 570 847 500 135 434 235 499 368 348 771 861 192 24 131 555 170 200 828 582 647 495 159 581 481 394 156 627 885 212 887 289 856 515 61 684 637 294 226 175 315 606 730 169 686 646 38 451 702 453 742 558 448 833 238 94 94 383 658 686 313 9 175 766 880 306 156 245 208 787 807 751 245 770 133 828 409 803 715 701 56 728 318 31 63 29 658 841 481 460 495 75 856 599 106 435 497 157 523 12 492 486 301 571 304 323 238 112 432 313 441 649 345 652 721 257 571 254 243 669 665 724 768 800 133 460 247 833 514 0 5 520 495 324 397 882 683 856 656 788 170 677 651 894 656 198 320 210 144 549 766 800 443 682 529 621 539 669 72 47 388 753 56 641 848 681 403 305 422 856 472 256 761 511 324 509 733 10 378 38 12 291 750 374 422 564 225 256 350 5 495 530 551 154 275 359 253 257 280 798 371 708 551 318 427 302 539 472 245 453 530 793 201 788 53 264 54 432 810 696 810 520 641 480 460 891 212 507 75 787 24 815 305 583 646 441 392 521 709 159 715 229 145 851 257 661 485 828 661 686 82 705 882 364 114 635 179 681 571 61 413 179 889 173 47 700 40 315 89 807 539 287 891 116 253 605 686 838 728 667 819 805 430 735 313 542 669 355 880 168 581 302 254 784 670 225 98 58 94 340 780 315 826 707 219 817 383 633 459 605 254 164 866 778 847 730 392 225 686 301 179 192 217 367 116 805 84 674 126 499 570 418 491 123 397 523 607 133 847 305 315 569 313 212 627 312 523 894 140 803 413 891 724 14 351 10 655 334 719 829 222 728 845 803 589 245 591 516 827 451 884 43 73 63 530 29 836 841 247 715 387 759 374 707 771 607 392 313 626 883 333 408 492 98 68 58 693 389 322 527 439 201 369 319 359 348 411 443 131 621 889 208 96 593 350 82 467 836 371 715 464 795 687 336 472 322 602 500 833 833 73 392 385 640 840 891 553 164 812 870 892 472 436 670 38 135 227 399 148 859 99 684 555 805 17 472 436 472 667 676 35 225 56 3 58 710 887 640 379 724 574 320 772 359 339 3 54 669 329 513 655 495 187 871 47 373 110 245 436 347 775 257 311];
% Read in data (line by line)
i = 1;
lineRead = true;
while (lineRead)
  newLine = fgetl (fid);
    
  if (newLine == -1)
    lineRead = false;
  else
    txtread{i} = newLine;
    i = i+1;
  end
end
fclose (fid);

backup_copy = txtread;

gridData = [];
figure;
hold on;

%convert to Grid
flip_index = 1;
for i = 1:length(txtread)
  if (length(txtread{i}) != 0)
    if (txtread{i}(1) != 'f')
      txtread{i}(txtread{i} == ',') = ' ';
      a = textscan(txtread{i}, '%f');
    
      x = a{1}(1) +1;
      y = a{1}(2) +1;
      %plot(x,y,'*');
      
      gridData(y, x) = 1;
    endif
    if (txtread{i}(1) == 'f')
      flip_ax(flip_index) = txtread{i}(12);
      flip_ax_coord(flip_index) = textscan(txtread{i}(14:end), '%f'){1} +1;
      flip_index += 1;
    endif
  endif

endfor




fold_gridData = gridData;
[max_y, max_x] = size(fold_gridData);
if(rem(max_y,2) == 0)
  fold_gridData(max_y +1, max_x) = 0;
endif
if(rem(max_x,2) == 0)
  fold_gridData(max_y, max_x+1) = 0;
endif
[max_y, max_x] = size(fold_gridData);

for i = 1:length(flip_ax)
  switch(flip_ax(i))
  case 'y'
    fold_gridData = fold_UD(fold_gridData, flip_ax_coord(i), max_y);   
  case 'x'
    fold_gridData = fold_LR(fold_gridData, flip_ax_coord(i), max_x);
  endswitch
  
endfor

sum(sum(fold_gridData))

%897 is too high 
%plot([655,655],[0,1000])




